# 海量用户通信即时通信系统
## 功能实现
### 1. 显示界面用户登录界面和登录菜单
- 直接定义用户菜单,利用一个标志位记录用户的选择,另外一个标志位是否继续显示菜单,如果标志位改变就可以退出了
- 之后的每一个函数中取出 key 的值,判断 key 的值进行相关的操作
### 2. 实现用户登录
![img.png](img/img.png)
问题 : 如何设计发送数据的形式: 可以利用 json 的格式发送,但是如何设计结构体,我们认为结构体(Message)中的字段包含:
- Type(其实就是发送数据的类型)
- Data (就是用户信息对应的一个结构体 json 序列化之后的字符串),其中结构体包含用户的基本信息

发送的流程:
1. 首先创建一个 Message 的结构体
2. mes.Type = 登录(注册)消息类型
3. mes.Data = 登录消息的类型
4. 对于mes 进行一个 json 序列化
5. 但是网路中的丢包问题如何解决:
   1. 首先给服务器发送mes 的长度
   2. 之后发送 mes 序列化字符串

服务器端接收消息的流程:
1. 接收到客户端发送的长度 len
2. 根据介绍到的长度和实际接收到消息本身对比 
3. 如果不相等,利用纠错协议(但是  ......)
4. 反序列化为 mes 类型
5. 取出 mes 中的 data 信息
6. 反序列化 data
7. 在数据库中利用 data 的信息查找对应信息
8. 根据比较内容返回一个 message 信息
9. 发送给客户端

但是上面服务器端发送的一个 message 信息结构体如何设计呢? message 结构体中包含以下信息：

- code 状态码
- error 错误信息(或者提示信息)

### 3.客户端发送消息,服务器端判断消息
1. 客户端发送消息,服务器端判断信息,返回信息给客户端
2. 客户端解析接收到的消息,根据解析的消息判断用户是否登录并且显示页面
3. 需要函数封装
### 4.服务器端处理反序列化之后的消息结构体,响应不同信息
由于 Mes 相当于无论是登陆还是注册,发送的 Mes 结构体都是一样的,所以接收到消息之后,可以根据发送消息的类型调用不同的函数,根据不同的情况调用不同的函数
注意项目的架构一定需要细化,各司其职,每一次层次分明
### 5. 服务器端的优化
优化结构的方法,便于程序的可扩展性和可维护性(注意项目架构),这里可以使用 MVC 架构模式, 利用 controller 层调用不同的处理器完成相应的请求,
如何进行架构,利用 MVC 的思想, 设置一个 controller 层, 一个大的控制器中包含多个小的控制器,小的控制器中包含关于某一个方面的所有函数的选择,
首先大的一个控制器把任务分配到一个小的控制器,小的控制器再把任务交给具体的函数处理, 另外可以把常用的方法和函数放入到一个 util 包中, 直接调用其中方法即可
服务器端的项目架构图如下(另外一个注意事项就是需要把一个层中所有方法中共同的属性抽象出来,抽成一个结构体,利用这一个结构体调用方法) :
![img.png](img/img2.png)
#### 优化的方法
1. 分析每一个函数和包的功能,创建相关文件
2. 首先先把分析的文件创建好,放到相应的包中
2. 将各个文件的作用不同,把函数剥离到各个包中
3. 开始调整,从最底层的开始,哪一个被调用的最多,就从哪一个开始,首先从util包开始构建

优化时的注意事项:

- 项目结构的优化方式就是把功能相关的代码抽取成函数,同时于某一个字段相关的函数放在一个包下,并且每一个包需要一个控制器控制使用哪一个函数进行操控,比如和 用户相关的操作就要使用一个包进行,
同时需要一个控制器控制登录和注册时的业务逻辑
- 另外一个重要的点就是: 把相同功能的函数抽成一个包之后,函数中经常使用的部分需要使用一个结构体完成封装,一个包对应一个结构体
- 需要定义一个主控制器,主控制器把任务分配个每一个控制器，小的控制器调用相关的函数(service层中的函数)
- 客户端和服务端相互独立,进行信息交互,都有自己的架构

### 6. 客户端的优化
1. 客户端的修改步骤基本和服务器端一致
2. 但是需要保证的一个要求就是客户端和服务器端之间一定需要有一个交互
3. 注意客户端的 controller 层的设计基本和 服务器端基本相同
4. util 包可以出现在客户端和服务端中

此时特别需要注意的就是一个 server.go ,其中就是放入的就是一个客户端和服务器端的交互过程,
其中包含了显示菜单的函数,另外定义了一个协程的任务(就是不断对服务器端的信息进行一个监听),如果服务器端显示信息,
这一个协程就会接收到信息,并且做出相应的响应(注意读取使用 ReadPkg 函数,见上面)
项目架构图:
![img.png](img/img3.png)
